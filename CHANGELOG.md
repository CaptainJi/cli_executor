# 更新日志

本项目的所有重要变更都将记录在此文件中。

格式基于[Keep a Changelog](https://keepachangelog.com/en/1.0.0/)，
本项目遵循[语义化版本](https://semver.org/spec/v2.0.0.html)。

## [1.0.5] - 2025-08-12

### 新增
- 🛡️ **输出长度控制** - 智能截断长输出，防止超出大模型上下文限制
- 📊 **输出统计信息** - 显示总行数、字符数和截断状态
- 🔍 **二进制输出检测** - 自动识别并跳过二进制数据的解码
- 🎯 **智能截断算法** - 按行截断，保持输出可读性

### 技术特性
- 最大输出长度：8000字符（约对应GPT-4的2K tokens）
- 最大行数限制：200行
- 二进制数据检测：可打印字符比例<70%时识别为二进制
- 截断标记：清晰显示截断位置和统计信息

### 改进
- 优化了长输出的处理逻辑
- 增强了输出格式的可读性
- 防止大模型上下文溢出错误
- 提升了系统稳定性

## [1.0.4] - 2025-08-12

### 修复
- 🔧 **调试信息控制修复** - 修复了非调试模式下仍显示调试信息的问题
- 🎯 **调试模式逻辑优化** - 只有使用`--debug`参数时才显示调试信息
- 📝 **输出格式优化** - 正常模式下输出更加简洁清晰

### 改进
- 优化了调试信息的显示逻辑
- 改进了命令行参数检测机制
- 增强了用户体验，避免信息干扰

### 技术细节
- 修复了`execute_command`、`execute_script`、`list_directory`函数中的调试逻辑
- 现在调试信息只在明确使用`--debug`参数时显示
- 正常模式下只显示命令的标准输出结果

## [1.0.3] - 2025-08-12

### 新增
- 🔧 **进一步的调试优化** - 持续改进调试信息的详细程度
- 📈 **性能优化** - 提升命令执行和日志记录的性能
- 🛠️ **代码质量改进** - 优化代码结构和可维护性

### 改进
- 进一步优化调试日志的输出格式
- 改进错误处理的健壮性
- 增强代码的可读性和维护性

### 修复
- 修复潜在的边界情况处理
- 优化内存使用和性能表现

## [1.0.2] - 2025-08-12

### 新增
- 🔍 **详细的调试日志** - 在命令执行过程中添加完整的调试信息
- 📊 **执行过程跟踪** - 记录命令执行的每个步骤和状态
- 🎯 **编码检测日志** - 显示编码检测和转换过程
- 📝 **输出内容预览** - 在调试模式下显示输出内容摘要

### 改进
- 增强execute_command函数的调试信息
- 增强execute_script函数的调试信息  
- 增强list_directory函数的调试信息
- 优化调试日志的格式和可读性
- 改进错误处理和状态报告

### 修复
- 修复调试模式下缺少详细执行信息的问题
- 改进命令执行过程的可见性
- 优化日志输出的结构化程度

## [1.0.1] - 2025-08-12

### 新增
- 🎨 **loguru日志系统集成** - 彩色输出和结构化日志记录
- 🔤 **增强的编码处理** - 支持多种编码格式（UTF-8、GBK、GB2312等）
- 📝 **改进的调试模式** - 更好的日志格式化和可读性
- 🎯 **转义字符处理** - 自动转换\n、\t、\r等转义字符
- 📦 **开发依赖支持** - 添加loguru、pytest等开发工具

### 修复
- 修复debug模式下的编码显示问题
- 改进中文和特殊字符的输出处理
- 解决与uvicorn日志系统的兼容性问题
- 优化日志格式，提高可读性

### 改进
- 更新日志系统，使用loguru替代标准logging
- 增强命令输出的编码检测和处理
- 改进错误消息的格式化显示
- 优化debug模式下的用户体验

## [1.0.0] - 2025-08-12

### 新增
- 🚀 **使用FastMCP 2.11+完全重写** - MCP服务器实现
- 🔧 **增强的命令执行** - 更好的错误处理和超时支持
- 📜 **改进的脚本执行** - 多shell支持和适当的清理
- 📁 **丰富的目录列表** - 文件大小格式化和隐藏文件支持
- 🖥️ **全面的系统信息** - 详细的系统和环境信息
- 📋 **增强的部署提示** - 更详细和结构化的部署指南
- ⚡ **多种传输支持** - stdio、HTTP和streamable-HTTP传输
- 🛡️ **安全特性** - 命令超时和更好的错误处理
- 🔍 **跨平台兼容性** - 改进的Windows、macOS和Linux支持
- 📚 **完善文档** - 包含示例的全面README
- 🧪 **测试套件** - 所有功能的自动化测试
- 📦 **示例配置** - 各种客户端的即用配置文件

### 变更
- **破坏性变更**: 从传统MCP迁移到FastMCP框架
- **破坏性变更**: 更新Python要求到3.8+
- **破坏性变更**: 入口点从`cli_executor.cli_server:main`改为`cli_executor.server:main`
- 改进命令行参数解析，提供更好的帮助文本
- 增强错误消息和日志记录
- 更新项目结构以遵循Python打包标准
- 用FastMCP装饰器替换自定义MCP实现

### 移除
- 传统MCP服务器实现
- setup.py（替换为pyproject.toml）
- 已弃用的环境变量处理
- 旧式函数注册

### 修复
- 不同系统上的shell环境加载
- 脚本执行中的临时文件清理
- 跨平台路径处理
- 长时间运行进程中的内存泄漏
- 并发命令执行中的竞态条件

### 安全
- 添加命令超时保护
- 改进输入验证
- 更好的错误消息清理
- 增强权限检查

## [0.5.0] - 之前版本

### 新增
- 基本CLI命令执行
- 多行脚本支持
- 目录列表功能
- 系统信息资源
- 基本部署提示
- HTTP和stdio传输支持

### 之前版本的功能
- 执行单个CLI命令
- 执行多行脚本
- 列出目录内容
- 获取系统信息
- 生成部署提示
- 环境变量配置
- 基本错误处理